---
articleTitle: いいともグランドフィナーレで最も密だった瞬間（○○するシェル芸ちゃん_最終日）
Keywords: ○○するシェル芸ちゃん, bash, シェル芸
Copyright: (C) 2021 sickleaf
---


<br>

[○○するシェル芸ちゃん](../../?page=advent_shellgeichan)アドベントカレンダーの最終日です。
<br><br>

バラエティの歴史に燦然と輝くいいともグランドフィナーレ。

リアルタイムの衝撃と、その後現場の様子が芸人ラジオで口々に語られるのは堪らないものがありました。

## 問題

```
2014年3月31日に放送された「笑っていいとも！グランドフィナーレ感謝の超特大号」のトークパートで、多くの人がステージ上に上がりました。
ゲストが増えてから、写真撮影の直前まで番組内の行動をメモした情報(data)を元に、一番人が多かった瞬間と、その時に並んでいた人を表示して下さい。
ただし、タモリと明石家さんまは最初からステージ上にいるものとします。
```

本当に「最も密だった瞬間」は写真撮影・胴上げの瞬間ですが、問題にならないので無かったことにしています。

ちなみに時刻は私の手元にある番組録画の再生時間に基づいたもので、CMカットが入った時刻です。


#### 問題データ(`cat data`)

```
44:53 IN 浜田 松本 内村 南原
45:14 QUIET さんま
46:12 HIT 浜田 内村
46:32 HIT 浜田 松本
46:34 HIT さんま 松本
47:54 HIT 浜田 さんま
48:31 TALK さんま
48:36 QUIET さんま
49:04 TALK さんま
49:06 QUIET さんま
49:21 DANCE 南原
50:28 TALK さんま
50:36 QUIET さんま
50:51 IN 木梨 石橋
51:16 TALK さんま
51:41 QUIET さんま
52:05 IN 田中 太田
52:22 HIT 浜田 松本
52:46 IN 岡村 矢部
53:31 IN おすぎ ピーコ
53:33 HUG おすぎ 田中
53:42 IN 中居
54:04 IN サンコン
54:10 HUG サンコン さんま
54:11 HIT 浜田 松本
54:14 HUG 松本 サンコン
54:14 HIT さんま 松本
54:15 KISS 松本 サンコン
54:16 HIT さんま 松本
54:18 HUG サンコン 浜田
54:23 HUG さんま 浜田
54:24 HIT さんま 浜田
54:26 OUT 木梨
54:29 HUG サンコン タモリ
54:36 IN 田中康夫
54:39 IN 木梨
54:41 DOWN 田中康夫
54:50 HUG 田中康夫 田中
54:50 IN 三村
54:51 HIT 田中 田中康夫
54:52 KICK 田中 田中康夫
54:52 OUT 田中康夫
54:57 OUT 三村
55:05 OUT おすぎ
55:06 OUT ピーコ
55:14 OUT サンコン
55:16 OUT さんま
55:19 IN さんま
55:32 APPLAUSE 岡村
56:42 APPLAUSE 岡村
56:56 HIT 浜田 太田
57:11 APPLAUSE 岡村
57:31 HIT 太田 田中
57:32 DOWN 田中
57:57 APPLAUSE 岡村
58:14 HIT 田中 太田
58:15 HIT 田中 太田
58:16 HIT 田中 太田
59:08 OUT 木梨
59:18 IN 鶴瓶 木梨
60:29 APPLAUSE 松本
61:37 APPLAUSE 岡村
61:40 OUT さんま
63:34 OUT 木梨
63:48 IN 橋田 木梨
64:15 HIT 石橋 太田
64:40 IN サンコン
64:57 HUG サンコン 鶴瓶
65:18 IN 草彅 香取
65:24 OUT 草彅 香取 橋田 サンコン
66:04 OUT 木梨
66:14 APPLAUSE 岡村
66:18 IN 神田 木梨
66:37 OUT 神田
66:40 OUT 中居 石橋 太田
66:44 OUT 鶴瓶
66:50 OUT 木梨
66:57 IN 中居
67:12 OUT 田中
67:42 DANCE 南原
66:49 APPLAUSE 南原
68:10 IN 柳沢
69:41 GAMESET 柳沢
```

問題データの作成がこんな楽しかったことはない。


## 回答方針

INが来たらメンバー追加、OUTが来たらメンバー削除を繰り返して、メンバーが一番多くなったところを出力します。

基本awkで処理します。

### 前処理

`QUIET`やら`HIT`やら`DANCE`やら関係のないデータが入っているので、grepでINとOUTだけに絞ります。

```
$ cat data | grep -E "IN|OUT"
44:53 IN 浜田 松本 内村 南原
50:51 IN 木梨 石橋
52:05 IN 田中 太田
52:46 IN 岡村 矢部
53:31 IN おすぎ ピーコ
53:42 IN 中居
54:04 IN サンコン
54:26 OUT 木梨
54:36 IN 田中康夫
54:39 IN 木梨
54:50 IN 三村
54:52 OUT 田中康夫
54:57 OUT 三村
55:05 OUT おすぎ
55:06 OUT ピーコ
55:14 OUT サンコン
55:16 OUT さんま
55:19 IN さんま
59:08 OUT 木梨
59:18 IN 鶴瓶 木梨
61:40 OUT さんま
63:34 OUT 木梨
63:48 IN 橋田 木梨
64:40 IN サンコン
65:18 IN 草彅 香取
65:24 OUT 草彅 香取 橋田 サンコン
66:04 OUT 木梨
66:18 IN 神田 木梨
66:37 OUT 神田
66:40 OUT 中居 石橋 太田
66:44 OUT 鶴瓶
66:50 OUT 木梨
66:57 IN 中居
67:12 OUT 田中
```

また、ステージに上るメンバーが複数いる場合、awk内で「IN,OUT以降の文字列」として扱うためにIN/OUT前後の空白をカンマに置き換えます。

```
$ cat data | grep -E "IN|OUT" | sed -r "s; (IN|OUT) ;,\1,;g" | awk -F, '{print $2,$3}'
IN 浜田 松本 内村 南原
IN 木梨 石橋
IN 田中 太田
IN 岡村 矢部
IN おすぎ ピーコ
IN 中居
IN サンコン
OUT 木梨
IN 田中康夫
IN 木梨
IN 三村
OUT 田中康夫
OUT 三村
OUT おすぎ
OUT ピーコ
OUT サンコン
OUT さんま
IN さんま
OUT 木梨
IN 鶴瓶 木梨
OUT さんま
OUT 木梨
IN 橋田 木梨
IN サンコン
IN 草彅 香取
OUT 草彅 香取 橋田 サンコン
OUT 木梨
IN 神田 木梨
OUT 神田
OUT 中居 石橋 太田
OUT 鶴瓶
OUT 木梨
IN 中居
OUT 田中
IN 柳沢
```

区切りをカンマにすることにより、出入りを`$2`、対象メンバーを`$3`として扱えるようになりました。

### INで増える人を計上する

最初にタモリとさんまが入っていることから、awkのBEGIN内で`member="タモリ さんま"`とします。

そして、2列目が`IN`だった場合、memberの後ろに対象メンバーを付け加える処理を行います。

awkのアクションに`if($2=="IN"){member=member" "$3}`を記述すれば反映されます。

```
$ cat data | grep -E "IN|OUT" | sed -r "s; (IN|OUT) ;,\1,;g" | awk -F, 'BEGIN{member="タモリ さんま"}{if($2=="IN"){member=member" "$3}print member}'
タモリ さんま 浜田 松本 内村 南原
タモリ さんま 浜田 松本 内村 南原 木梨 石橋
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま 鶴瓶 木梨
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま 鶴瓶 木梨 橋田 木梨
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま 鶴瓶 木梨 橋田 木梨 サンコン
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま 鶴瓶 木梨 橋田 木梨 サンコン 草彅 香取
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま 鶴瓶 木梨 橋田 木梨 サンコン 草彅 香取 神田 木梨
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま 鶴瓶 木梨 橋田 木梨 サンコン 草彅 香取 神田 木梨 中居
タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村 さんま 鶴瓶 木梨 橋田 木梨 サンコン 草彅 香取 神田 木梨 中居 柳沢
```

ステージに上った人の行だけカウントしているため、何度も出入りしている木梨やサンコンは重複してしまっています。

### OUTで減る人を削除する

**2列目が`OUT`だった場合、3列目の人に対して`member`からカットする**処理を行います。

ただ3列目にはスペース区切りで複数人いるケースがあるため、3列目の文字列をスペース区切りで配列に入れ、その中の全ての要素について繰り返し取り除かなければなりません。

3列目をスペース区切りで分けた配列を`outlist`とすると、`split($3,outlist," ")`となります。

##### 3列目の各メンバーについて削除する

`split`で配列`outlist`に格納したら、`gsub`を使ってメンバー一覧(`member`)からそれぞれ削除していきます。

`for(i in outlist){gsub(outlist[i],"",member)}`


配列`outlist`の中身全てに対して実行するため拡張for文を使い、配列の各要素（`outlist[i]`）をメンバーから取り除いていきます。


```
$ cat data | grep -E "IN|OUT" | sed -r "s; (IN|OUT) ;,\1,;g" | awk -F, 'BEGIN{member="タモリ さんま"}{if($2=="IN"){member=member" "$3}else if($2=="OUT"){split($3,outlist," ");for(i in outlist)gsub(outlist[i],"",member) };print "["$2","$3"]",member}'
[IN,浜田 松本 内村 南原] タモリ さんま 浜田 松本 内村 南原
[IN,木梨 石橋] タモリ さんま 浜田 松本 内村 南原 木梨 石橋
[IN,田中 太田] タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田
[IN,岡村 矢部] タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部
[IN,おすぎ ピーコ] タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ
[IN,中居] タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居
[IN,サンコン] タモリ さんま 浜田 松本 内村 南原 木梨 石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン
[OUT,木梨] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン
[IN,田中康夫] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫
[IN,木梨] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨
[IN,三村] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村
[OUT,田中康夫] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン  木梨 三村
[OUT,三村] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン  木梨
[OUT,おすぎ] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部  ピーコ 中居 サンコン  木梨
[OUT,ピーコ] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居 サンコン  木梨
[OUT,サンコン] タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居   木梨
[OUT,さんま] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居   木梨
[IN,さんま] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居   木梨  さんま
[OUT,木梨] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居     さんま
[IN,鶴瓶 木梨] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居     さんま 鶴瓶 木梨
[OUT,さんま] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶 木梨
[OUT,木梨] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶
[IN,橋田 木梨] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶  橋田 木梨
[IN,サンコン] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶  橋田 木梨 サンコン
[IN,草彅 香取] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶  橋田 木梨 サンコン 草彅 香取
[OUT,草彅 香取 橋田 サンコン] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶   木梨
[OUT,木梨] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶
[IN,神田 木梨] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶       神田 木梨
[OUT,神田] タモリ  浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部   中居      鶴瓶        木梨
[OUT,中居 石橋 太田] タモリ  浜田 松本 内村 南原   田中  岡村 矢部         鶴瓶        木梨
[OUT,鶴瓶] タモリ  浜田 松本 内村 南原   田中  岡村 矢部                 木梨
[OUT,木梨] タモリ  浜田 松本 内村 南原   田中  岡村 矢部
[IN,中居] タモリ  浜田 松本 内村 南原   田中  岡村 矢部                  中居
[OUT,田中] タモリ  浜田 松本 内村 南原     岡村 矢部                  中居
[IN,柳沢] タモリ  浜田 松本 内村 南原     岡村 矢部                  中居 柳沢
```

途中経過が分かりやすいように、`member`と共に2列目、3列目も一緒に出力しています。（`print "["$2","$3"]",member`）

柳沢慎吾が出てきた時は`タモリ×ダウンタウン×中居×ウッチャンナンチャン×ナインティナイン`だったので、想定通りメンバー削除が出来ていることが分かります。

### 前の行と比べて一番人が多かったかどうか判定する

2列目のIN,OUTに応じてステージ上に居る人は`member`に格納されました。これが過去比べて一番大きいかメモする必要があります。

2列目のIN,OUTの分岐と処理が終わった後に、下記のように記述します。

`split(member,list," "); if(max<length(list)){max=length(list);mtime=$1;mlist=member}`

`member`は文字列のため、空白で区切って配列`list`に格納します。

そして`list`の長さが`max`より大きい場合、`list`の長さを`max`に格納して時刻とメンバーをメモします。

全行処理が終わったら、ENDパターンで`mtime`と`mlist`を出力すれば終了です。

## 回答例

```
$ cat data | grep -E "IN|OUT" | sed -r "s; (IN|OUT) ;,\1,;g" | awk -F, 'BEGIN{member="タモリ さんま"}{if($2=="IN"){member=member" "$3}else if($2=="OUT"){split($3,outlist," ");for(i in outlist)gsub(outlist[i],"",member)};split(member,list," ");if(max<length(list)){max=length(list);mtime=$1;mlist=member}}END{printf "time:%s, member:%s\n",mtime,mlist}'
time:54:50, member:タモリ さんま 浜田 松本 内村 南原  石橋 田中 太田 岡村 矢部 おすぎ ピーコ 中居 サンコン 田中康夫 木梨 三村
```

```
54:36 IN 田中康夫
54:39 IN 木梨
54:41 DOWN 田中康夫
54:50 HUG 田中康夫 田中
54:50 IN 三村
54:51 HIT 田中 田中康夫
54:52 KICK 田中 田中康夫
54:52 OUT 田中康夫
54:57 OUT 三村
```

該当する部分は、**木梨憲武に連れられて田中康夫がステージに上がり、かつてビートたけしが田中康夫の首を絞めて倒したオマージュで太田光が田中康夫をステージに沈め、起き上がった田中康夫が爆笑問題田中に絡みにいったところ返り討ちに遭っているどさくさに紛れてさまぁ～ず三村がステージに上がった瞬間**でした。


#### おまけ

分かる人向けに置いておきます。

```
「お前餅ついとったよなあ？」
「長い！！」
「まだまだ売れるわこの人」
「関係ない！俺はヒルナンデスじゃない！」
「とんねるずが来たらネットが荒れるから」
「滝に打たれて泡を吹く」
「お前嘘ばっかり言うなよ！」
「いや思い出はあるでしょ、あっ…」
「長ぇよ」
「自分でやんのかい！」
「今出ちゃダメ！」
「皆もおいで！」
「どういうこと？」
「これはええわ」
「もっかい言うけど、ネットが荒れる！」
「これ…プロレス？」
「順番抜かし！順番抜かし！」
「おすぎとピーコ出てこいや！」
「中居も来いや！」
「整理しよう、整理しよう！」
「これ俺の番組！」
「憲武さん関係ねえから！」
「それはたけしさんのやつ！」
「お前関係ないやないかい」
「上がれ上がれ！」
「サンコンちゃうか？」
「いつものお得意の入り方！」
「場が落ち着くね」
「帰り際もやらしいよねぇ～」
「おい殴り込み行こうぜ！」
「先生だから。先生だから。」
「サンコーン！」
「何で橋田さんとサンコンさんなんですか？」
「コンプライアンス大丈夫？」
「出てきただけでスベっとるやないか」
「明日の友達紹介してもらって…」
「何やねんお前らさっきから！」
「今入るから」
「高校野球！」
「別にレギュラーやなかってもええやん」
「協力しなさいよ！」
「橋田先生を胴上げしましょうよ」
「橋田ー！」
```

## ○○する芸能ちゃんブロック

カレンダーを立ち上げた時から、最終日のお題も、最後に紹介する動画も決めておりました。是非ご覧下さい。

自分で気づいているので書きますが、号泣の赤岡さんを**赤池さんと間違えて投稿していました。**収録時はそのまま入ってしまいましたが編集で直して頂き大変感謝しております。

<div class="youtube">
<iframe width="560" height="315" src="https://www.youtube.com/embed/z8pnzJHUBug" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

以上、完走！！　ありがとうございました！

<style>
.youtube {
  position: relative;
  width: 100%;
  padding-top: 56.25%;
}
.youtube iframe {
  position: absolute;
  top: 0;
  right: 0;
  width: 100% !important;
  height: 100% !important;
}
</style>
