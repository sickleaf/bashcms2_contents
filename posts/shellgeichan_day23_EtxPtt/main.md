---
articleTitle: ひらがな推しBlu-rayのタイトルの表記揺れを直しましょうや～！（○○するシェル芸ちゃん_23日目）
Keywords: ○○するシェル芸ちゃん, bash, シェル芸
Copyright: (C) 2022 sickleaf
---


<br>

[○○するシェル芸ちゃん](../../?page=advent_shellgeichan)アドベントカレンダーの23日目です。
<br><br>

過去放送されたバラエティ番組の各放送回を全て円盤にして販売されるって凄い事ですよね。

一時期ひらがな推しのクイズを作ってみんはやで放流することに執着していた時期がありまして、問題をスプレッドシートで管理するにあたり、各回の放送タイトルはどこに準拠しようか？と悩んでおりました。

今年の1月1日を以ってめでたく円盤になったので、公式サイトのリリース情報から取れば良いのかと思い辿ったところ…

## 問題

```
「ひらがな推し」のBlu-rayに収録されている各放送回のタイトルが下記URLに含まれています。第一弾・第二弾それぞれのデータを取得した上で、表記揺れを極力直し、放送順にソートして下さい。
第一弾：https://www.hinatazaka46.com/s/official/news/detail/R00068?ima=0000
第二弾：https://www.hinatazaka46.com/s/official/news/detail/R00117?ima=0000
```

第一弾と第二弾で表記揺れがあるのはまだ分かる。

同じラインアップ内でも表記揺れがあるのはどういうこっちゃ。

<img src="https://user-images.githubusercontent.com/5824061/148642499-1ae8af22-067b-40d9-b26f-fb07750e9835.png"  width=20%>

それも復ビンでね。

## 回答方針

データが第一弾と第二弾で分かれるので、整形の中でもソート前とソート後のどちらで行うか判断が必要です。

何はともあれ両方のデータを持ってきましょう。

### データ取得

`curl`などで取得して一旦テキストに保存します。最後のワンライナーでは保存せずそのままパイプラインに流すように置き換えますが、検討段階では毎回アクセスする待ち時間をスキップしましょう。

```
curl -s https://www.hinatazaka46.com/s/official/news/detail/R00068?ima=0000 > 1st
curl -s https://www.hinatazaka46.com/s/official/news/detail/R00117?ima=0000 > 2nd
```

放送回のタイトルとはこの辺の部分を指します。

##### 1st

```
<p><span>～各</span><span>5</span><span>タイトル収録内容詳細～</span>&nbsp;</p>
<p><span>「としちゃんと愉快な仲間たち編」（加藤史帆）</span></p>
<p><span>＃</span><span>10 </span><span>けやき坂</span><span>46 </span><span>デビュ ーアルバム「走り出す瞬間」ヒット祈願！！前半戦</span></p>
<p><span>＃</span><span>11 </span><span>けやき坂</span><span>46 </span><span>デビュ ーアルバム「走り出す瞬間」ヒット祈願！！後半戦</span></p>
<p><a name="_Hlk63259826"></a><span>＃</span><span>20 </span><span><span>未来の芥川 賞作家を探せ！書き出し王決定戦</span> </span><span><span>前半戦</span></span></p>
<p><span><span>＃</span><span>21 </span></span><span><span>未来の芥川賞作家を探せ！ 書き出し王決定戦</span> </span><span><span>後半戦</span></span></p>
<p><span>#44 </span><span>あなたのお悩み解決！</span><span>&rdquo;</span><span>スナ ック眞緒</span><span>&rdquo;</span><span>【第</span><span>13</span><span>夜</span><span>/</span><span>第</span><span>14</span><span>夜</span><span>/</span><span>第</span><span>15</span><span>夜】</span></p>
<p><span>&nbsp;</span></p>
<p><span>特典映像①未公開映像</span></p>
<p><span>特典映像②メンバー座談会</span></p>
<p><span>メンバー：加藤史帆、高瀬愛奈、渡邉美穂</span></p>
<p><span>特典映像③スタジオライブ</span></p>
<p><span>＃</span><span>18 </span><span>「ハッピーオーラ」</span></p>
<p><span>＃</span><span>22 </span><span>「男友達だから」</span></p>
<p><span>＃</span><span>31 </span><span>「ノックをするな！」</span></p>
<p><span>&nbsp;</span></p>
<p><span>&nbsp;</span></p>
```

##### 2nd

```
                <div class="p-article__text">
                  2022年1月1日(土)元旦に第2弾「ひらがな推し」Blu-ray 5タイトルの発売が決定致しました！<br />今回のBlu-ray 5タイトルは、金村美玖・丹生明里・松田好花・渡 邉美穂・上村ひなの<br />の5名が、2018年4月9日から2019年4月1日まで放送されていた「ひ らがな推し」の中からファンの皆さんにお薦めしたい放送回をピックアップ！<br />第2弾「 ひらがな推し」Blu-rayも、本編に加え、未公開映像、スタジオライブ、そして新撮トークを 交えながらお届け致します。<br />けやき坂46時代からのファンはもちろん、日向坂46へ改名後にファンとなった方も楽しんでいただける作品となっております！<br /><br />【2022年1 月1日(土)第2弾「ひらがな推し」Blu-ray 全5タイトル同時発売】<br /><br />タイトル：「 初ガツオを推すしかない編」（金村美玖） <br />価格：5,500円(税別)<br />品番：SRXW-45<br /><br />タイトル：「好きな人いるの？ニブだよ編」（丹生明里）<br />価格：5,500円( 税別)<br />品番：SRXW-46<br /><br />タイトル：「ヘビーリトルトゥース誕生編」（松田好花）<br />価格：5,500円(税別)<br />品番：SRXW-47<br /><br />タイトル：「埼玉と春日が生んだ怒涛の起爆剤編」（渡邉美穂）<br />価格：5,500円(税別)<br />品番：SRXW-48<br /><br />タイトル：「いつでもどこでも変化球編」（上村ひなの）<br />価格：5,500円(税別)<br />品番：SRXW-49<br /><br />★初回仕様限定盤 共通封入特典★<br />応募特典シリアルナ ンバー封入<br />スペシャルプレゼント抽選応募詳細は後日発表致します。<br /><br /><a href="https://smr.lnk.to/SRXW45-49">～ご予約はこちら～</a><br />※&rdquo;CDショップ・ オンラインショップでのご予約は、11月15日（月）AM10：00～順次受付開始となります&rdquo;<br /><br /><br />～各5タイトル収録内容詳細～ <br />■初ガツオを推すしかない編（金村美玖）<br />♯3　春日プレゼンツ！丸暗記メンバープロフィール紹介　その３<br />♯14　さ らなる魅力を引き出せ!家族アンケート 前半戦<br />
                  （以下略）
```

第一弾と第二弾でもHTMLの作りが違う…ビンタだビンタ。

### 第一弾のデータ

放送回タイトル部分だけを抜き出すためにちまちま行います。

ページを見ても分かる通り、タイトル収録内容詳細から特典映像の情報がそれぞれ記載されています。

中でも「特典映像①」の表記が必ずあるので、この前の数行を拾います。

また、HTMLタグがごちゃごちゃ入っているのでsedで取り除きます。

```
$ cat 1st  | grep -B7 特典映像①   | sed -r "s;<[^>]*>;;g"
「としちゃんと愉快な仲間たち編」（加藤史帆）
＃10 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願！！前半戦
＃11 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願！！後半戦
＃20 未来の芥川賞作家を探せ！書き出し王決定戦 前半戦
＃21 未来の芥川賞作家を探せ！書き出し王決定戦 後半戦
#44 あなたのお悩み解決！&rdquo;スナック眞緒&rdquo;【第13夜/第14夜/第15夜】
&nbsp;
特典映像①未公開映像
--
「京子さん、何してんですか編」（齊藤京子）
♯22 けやき坂46 学力テスト 前半戦
♯23 けやき坂46 学力テスト 後半戦
♯29 チーム対抗！！3分リレークッキング 前半戦
♯30 チーム対抗！！3分リレークッキング 後半戦
♯31 けやき坂46 絵心ミュージアム
&nbsp;
特典映像①未公開映像
--
「日向のバラエティ女王誕生編」（佐々木久美）
＃16 ドキッ！けやき坂46だらけの爆笑大喜利大会 前編
＃17 ドキッ！けやき坂46だらけの爆笑大喜利大会 後編
＃25 けやき坂46何でもランキング その①
＃26 けやき坂46何でもランキング その②
＃27 けやき坂46何でもランキング その③
&nbsp;
特典映像①未公開映像
--
&nbsp;
&nbsp;
「パンの鉄砲を撃ちますよ編」（表紙：佐々木美玲）
＃7 春日に挑戦！特技バトル！！前半戦
＃8 春日に挑戦！特技バトル！！後半戦
＃12 けやき坂46ヤングVSアダルト バラエティゲームバトル
＃13 けやき坂46の世界一やりたい授業
特典映像①未公開映像
--
「あだ名がおたけになりました編」（高本彩花）
＃1 春日プレゼンツ！丸暗記 メンバープロフィール紹介！その１
#2 春日プレゼンツ！丸暗記 メンバープロフィール紹介！その2
＃28 あなたのお悩み解決！&rdquo;スナック眞緒&rdquo;【第4夜/第5夜/第6夜】
＃33 オードリーとの距離をもっと縮めよう 前半戦
＃34 オードリーとの距離をもっと縮めよう 後半戦
&nbsp;
特典映像①未公開映像
```

`grep -B7 特典映像①`で「特典映像①」の前の7行、`sed -r "s;<[^>]*>;;g"`で、`<`で始まり`>`で終わるまでの全てのパーツをカットします。

ちなみに、「特典映像①」の前から拾う行数を広げすぎると、特典映像③のスタジオライブの＃まで拾ってしまい、後々の処理で残ってしまうため絞っています。


#### 放送回数表記を直す

括弧のある・なしとか、丸囲みの数字ある・なしはまだ分かる。

何故シャープの表記が同一ページ内で揺れているんだ。

半角全角はさておき、**音楽記号のシャープまである**やんけ。仕方ないので３パターン全て拾います。

また、放送回数が1桁の場合は0埋めをしないとソートが上手くいかないのでsedで加工します。

```
$ cat 1st  | grep -B7 特典映像①   | sed -r "s;<[^>]*>;;g" | grep -E "#|＃|♯" | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g"
#10 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願！！前半戦
#11 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願！！後半戦
#20 未来の芥川賞作家を探せ！書き出し王決定戦 前半戦
#21 未来の芥川賞作家を探せ！書き出し王決定戦 後半戦
#44 あなたのお悩み解決！&rdquo;スナック眞緒&rdquo;【第13夜/第14夜/第15夜】
#22 けやき坂46 学力テスト 前半戦
#23 けやき坂46 学力テスト 後半戦
#29 チーム対抗！！3分リレークッキング 前半戦
#30 チーム対抗！！3分リレークッキング 後半戦
#31 けやき坂46 絵心ミュージアム
#16 ドキッ！けやき坂46だらけの爆笑大喜利大会 前編
#17 ドキッ！けやき坂46だらけの爆笑大喜利大会 後編
#25 けやき坂46何でもランキング その①
#26 けやき坂46何でもランキング その②
#27 けやき坂46何でもランキング その③
#07 春日に挑戦！特技バトル！！前半戦
#08 春日に挑戦！特技バトル！！後半戦
#12 けやき坂46ヤングVSアダルト バラエティゲームバトル
#13 けやき坂46の世界一やりたい授業
#01 春日プレゼンツ！丸暗記 メンバープロフィール紹介！その１
#02 春日プレゼンツ！丸暗記 メンバープロフィール紹介！その2
#28 あなたのお悩み解決！&rdquo;スナック眞緒&rdquo;【第4夜/第5夜/第6夜】
#33 オードリーとの距離をもっと縮めよう 前半戦
#34 オードリーとの距離をもっと縮めよう 後半戦
```

放送回数が1桁通番を2桁にする処理は2回に分けています。

`sed -r "s;(#|＃|♯);#0;g"`で、全パターンのシャープを半角にして0を追加します。

`sed -r "s;#.([0-9][0-9]);#\1;g"`で、先ほどの処理で3桁になったものから0を取り除いています。

### 第二弾のデータ

全てのデータが1行に収まっているのでとりあえず`<br />`で改行した上で、第一弾と同様の処理を行います。

```
$ cat 2nd  | sed "s;<br />;\n;g" | grep -B7 特典映像 | grep -E "#|＃|♯"  | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g"
#03　春日プレゼンツ！丸暗記メンバープロフィール紹介　その３
#14　さらなる魅力を引き出せ!家族アンケート 前半戦
#15　さらなる魅力を引き出せ!家族アンケート 後半戦
#38　新春! けやき坂46! 2019年　一番運が良いのは誰だランキング
#39　成人vs未成年 大人力対決!! 前半戦
#40　成人vs未成年 大人力対決!! 後半戦
#09　妄想みらいヒストリー（富田・丹生・影山・井口）
#24　あなたのお悩み解決!「スナック眞緒」開店!【第１夜/第２夜/第３夜】
#36　けやき坂46 ぶりっ子選手権! 前半戦
#37　けやき坂46 ぶりっ子選手権! 後半戦
#47　あなたのお悩み解決!「スナック眞緒」【第１６夜/第１７夜/最終夜】
#35　あなたのお悩み解決!「スナック眞緒」【第１０夜/第１１夜/第１２夜】
#41　ひらがなメンバー初めての企画プレゼンを皆で何とか成功させよう!
#43　「へのつっぱりはいらんですよ!」キン肉マンを習得しよう!
#45　松田好花プレゼンツ!　ひらがな がっきょくうんどうかい①
#46　松田好花プレゼンツ!　ひらがな がっきょくうんどうかい②
#04　春日プレゼンツ！　丸暗記メンバープロフィール紹介その４
#05　けやき坂46 結成2周年記念　抜き打ちカバンの中身チェック! 前半戦
#06　けやき坂46 結成2周年記念　抜き打ちカバンの中身チェック! 後半戦
#18　一期生VS二期生 運動能力バトル! 前半戦
#19　一期生VS二期生 運動能力バトル! 後半戦
#32　あなたのお悩み解決!「スナック眞緒」【第７夜/第８夜/第９夜】
#42　唯一の三期生 上村ひなのをみんなでもっと知ろう!
#47　日向坂46 デビューシングルヒット祈願　内容発表!!
#48　日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう!　その①
#49　日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう!　その②
#50　日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう!　その③
```

特典映像は①などの番号が付かずに、配下に１：　２：　３：と入っているのでgrepの値を変えています。

また、こちらには不要なHTMLタグが無かったのでそのためのsed文はカットしました。

### ソート・共通化

第一弾、第二弾揃って、半角のシャープに放送回数が2桁で入るようになったのでようやくソートが出来ます。

ここまで行ってきた表記揺れの修正はソートするためのものであり、ソートに関係のない修正は全てその後に回しています。

ソートのために整形した2件のデータを並べてみます。

```
$ sort <(cat 1st  | grep -B7 特典映像①   | sed -r "s;<[^>]*>;;g" | grep -E "#|＃|♯" | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g") <(cat 2nd  | sed "s;<br />;\n;g" | grep -B7 特典映像 | grep -E "#|＃|♯"  | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g")
#01 春日プレゼンツ！丸暗記 メンバープロフィール紹介！その１
#02 春日プレゼンツ！丸暗記 メンバープロフィール紹介！その2
#03　春日プレゼンツ！丸暗記メンバープロフィール紹介　その３
#04　春日プレゼンツ！　丸暗記メンバープロフィール紹介その４
#05　けやき坂46 結成2周年記念　抜き打ちカバンの中身チェック! 前半戦
#06　けやき坂46 結成2周年記念　抜き打ちカバンの中身チェック! 後半戦
#07 春日に挑戦！特技バトル！！前半戦
#08 春日に挑戦！特技バトル！！後半戦
#09　妄想みらいヒストリー（富田・丹生・影山・井口）
#10 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願！！前半戦
#11 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願！！後半戦
#12 けやき坂46ヤングVSアダルト バラエティゲームバトル
#13 けやき坂46の世界一やりたい授業
#14　さらなる魅力を引き出せ!家族アンケート 前半戦
#15　さらなる魅力を引き出せ!家族アンケート 後半戦
#16 ドキッ！けやき坂46だらけの爆笑大喜利大会 前編
#17 ドキッ！けやき坂46だらけの爆笑大喜利大会 後編
#18　一期生VS二期生 運動能力バトル! 前半戦
#19　一期生VS二期生 運動能力バトル! 後半戦
#20 未来の芥川賞作家を探せ！書き出し王決定戦 前半戦
#21 未来の芥川賞作家を探せ！書き出し王決定戦 後半戦
#22 けやき坂46 学力テスト 前半戦
#23 けやき坂46 学力テスト 後半戦
#24　あなたのお悩み解決!「スナック眞緒」開店!【第１夜/第２夜/第３夜】
#25 けやき坂46何でもランキング その①
#26 けやき坂46何でもランキング その②
#27 けやき坂46何でもランキング その③
#28 あなたのお悩み解決！&rdquo;スナック眞緒&rdquo;【第4夜/第5夜/第6夜】
#29 チーム対抗！！3分リレークッキング 前半戦
#30 チーム対抗！！3分リレークッキング 後半戦
#31 けやき坂46 絵心ミュージアム
#32　あなたのお悩み解決!「スナック眞緒」【第７夜/第８夜/第９夜】
#33 オードリーとの距離をもっと縮めよう 前半戦
#34 オードリーとの距離をもっと縮めよう 後半戦
#35　あなたのお悩み解決!「スナック眞緒」【第１０夜/第１１夜/第１２夜】
#36　けやき坂46 ぶりっ子選手権! 前半戦
#37　けやき坂46 ぶりっ子選手権! 後半戦
#38　新春! けやき坂46! 2019年　一番運が良いのは誰だランキング
#39　成人vs未成年 大人力対決!! 前半戦
#40　成人vs未成年 大人力対決!! 後半戦
#41　ひらがなメンバー初めての企画プレゼンを皆で何とか成功させよう!
#42　唯一の三期生 上村ひなのをみんなでもっと知ろう!
#43　「へのつっぱりはいらんですよ!」キン肉マンを習得しよう!
#44 あなたのお悩み解決！&rdquo;スナック眞緒&rdquo;【第13夜/第14夜/第15夜】
#45　松田好花プレゼンツ!　ひらがな がっきょくうんどうかい①
#46　松田好花プレゼンツ!　ひらがな がっきょくうんどうかい②
#47　あなたのお悩み解決!「スナック眞緒」【第１６夜/第１７夜/最終夜】
#47　日向坂46 デビューシングルヒット祈願　内容発表!!
#48　日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう!　その①
#49　日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう!　その②
#50　日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう!　その③
```

これで並びましたが、シャープの揺れを直す部分以降は1st,2ndに共通している処理なので共通化するべきです。

簡略化すると以下のようになります。

`cat <(cat 1st  | grep -B7 特典映像①  | sed -r "s;<[^>]*>;;g") <(cat 2nd  | sed "s;<br />;\n;g" | grep -B7 特典映像)  | grep -E "#|＃|♯" | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g" | sort ` 

最初のコマンドがsortからcatになりましたが、これはソートが共通化する処理の後に行う処理のためで、必要なデータをまず並べるためにcatしています。

### 表記揺れの修正

あとは気になる表記揺れをsedで直していく地味な作業です。

#### 記号・数字の全角半角、ナンバリング（①～③）の正規化

半角・全角が入り乱れているので直します。

`sed y`により、「①」や「１」は全て半角の1に、「！」や全角スペースはいずれも半角にします。

`sed "y/　①②③１２３４５６７８９０！/ 1231234567890\!/"`で置き換え前後の文字を定義します。

```
$ cat <(cat 1st  | grep -B7 特典映像①  | sed -r "s;<[^>]*>;;g") <(cat 2nd  | sed "s;<br />;\n;g" | grep -B7 特典映像)  | grep -E "#|＃|♯" | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g" | sort | sed "y/　①②③１２３４５６７８９０！/ 1231234567890\!/"
#01 春日プレゼンツ!丸暗記 メンバープロフィール紹介!その1
#02 春日プレゼンツ!丸暗記 メンバープロフィール紹介!その2
#03 春日プレゼンツ!丸暗記メンバープロフィール紹介 その3
#04 春日プレゼンツ! 丸暗記メンバープロフィール紹介その4
#05 けやき坂46 結成2周年記念 抜き打ちカバンの中身チェック! 前半戦
#06 けやき坂46 結成2周年記念 抜き打ちカバンの中身チェック! 後半戦
#07 春日に挑戦!特技バトル!!前半戦
#08 春日に挑戦!特技バトル!!後半戦
#09 妄想みらいヒストリー（富田・丹生・影山・井口）
#10 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願!!前半戦
#11 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願!!後半戦
#12 けやき坂46ヤングVSアダルト バラエティゲームバトル
#13 けやき坂46の世界一やりたい授業
#14 さらなる魅力を引き出せ!家族アンケート 前半戦
#15 さらなる魅力を引き出せ!家族アンケート 後半戦
#16 ドキッ!けやき坂46だらけの爆笑大喜利大会 前編
#17 ドキッ!けやき坂46だらけの爆笑大喜利大会 後編
#18 一期生VS二期生 運動能力バトル! 前半戦
#19 一期生VS二期生 運動能力バトル! 後半戦
#20 未来の芥川賞作家を探せ!書き出し王決定戦 前半戦
#21 未来の芥川賞作家を探せ!書き出し王決定戦 後半戦
#22 けやき坂46 学力テスト 前半戦
#23 けやき坂46 学力テスト 後半戦
#24 あなたのお悩み解決!「スナック眞緒」開店!【第1夜/第2夜/第3夜】
#25 けやき坂46何でもランキング その1
#26 けやき坂46何でもランキング その2
#27 けやき坂46何でもランキング その3
#28 あなたのお悩み解決!&rdquo;スナック眞緒&rdquo;【第4夜/第5夜/第6夜】
#29 チーム対抗!!3分リレークッキング 前半戦
#30 チーム対抗!!3分リレークッキング 後半戦
#31 けやき坂46 絵心ミュージアム
#32 あなたのお悩み解決!「スナック眞緒」【第7夜/第8夜/第9夜】
#33 オードリーとの距離をもっと縮めよう 前半戦
#34 オードリーとの距離をもっと縮めよう 後半戦
#35 あなたのお悩み解決!「スナック眞緒」【第10夜/第11夜/第12夜】
#36 けやき坂46 ぶりっ子選手権! 前半戦
#37 けやき坂46 ぶりっ子選手権! 後半戦
#38 新春! けやき坂46! 2019年 一番運が良いのは誰だランキング
#39 成人vs未成年 大人力対決!! 前半戦
#40 成人vs未成年 大人力対決!! 後半戦
#41 ひらがなメンバー初めての企画プレゼンを皆で何とか成功させよう!
#42 唯一の三期生 上村ひなのをみんなでもっと知ろう!
#43 「へのつっぱりはいらんですよ!」キン肉マンを習得しよう!
#44 あなたのお悩み解決!&rdquo;スナック眞緒&rdquo;【第13夜/第14夜/第15夜】
#45 松田好花プレゼンツ! ひらがな がっきょくうんどうかい1
#46 松田好花プレゼンツ! ひらがな がっきょくうんどうかい2
#47 あなたのお悩み解決!「スナック眞緒」【第16夜/第17夜/最終夜】
#47 日向坂46 デビューシングルヒット祈願 内容発表!!
#48 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その1
#49 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その2
#50 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その3
```

これでナンバリング部分は全てレイアウトが揃いました。

#### 特殊文字参照の修正

`&rdquo;スナック眞緒&rdquo;`という記述が2箇所あります。

同じダブルクォーテーションですが、カギカッコの開始・終了にそれぞれ置き換えます。

`sed -r "s/&rdquo;(.*)&rdquo;/「\1」/g" `により、`&rdquo;`で囲われた部分を抜き出し、「」で囲むことが出来ます。

```
$ cat <(cat 1st  | grep -B7 特典映像①  | sed -r "s;<[^>]*>;;g") <(cat 2nd  | sed "s;<br />;\n;g" | grep -B7 特典映像)  | grep -E "#|＃|♯" | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g" | sort | sed "y/　①②③１２３４５６７８９０！/ 1231234567890\!/" | sed -r "s/&rdquo;(.*)&rdquo;/「\1」/g"
#01 春日プレゼンツ!丸暗記 メンバープロフィール紹介!その1
#02 春日プレゼンツ!丸暗記 メンバープロフィール紹介!その2
#03 春日プレゼンツ!丸暗記メンバープロフィール紹介 その3
#04 春日プレゼンツ! 丸暗記メンバープロフィール紹介その4
#05 けやき坂46 結成2周年記念 抜き打ちカバンの中身チェック! 前半戦
#06 けやき坂46 結成2周年記念 抜き打ちカバンの中身チェック! 後半戦
#07 春日に挑戦!特技バトル!!前半戦
#08 春日に挑戦!特技バトル!!後半戦
#09 妄想みらいヒストリー（富田・丹生・影山・井口）
#10 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願!!前半戦
#11 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願!!後半戦
#12 けやき坂46ヤングVSアダルト バラエティゲームバトル
#13 けやき坂46の世界一やりたい授業
#14 さらなる魅力を引き出せ!家族アンケート 前半戦
#15 さらなる魅力を引き出せ!家族アンケート 後半戦
#16 ドキッ!けやき坂46だらけの爆笑大喜利大会 前編
#17 ドキッ!けやき坂46だらけの爆笑大喜利大会 後編
#18 一期生VS二期生 運動能力バトル! 前半戦
#19 一期生VS二期生 運動能力バトル! 後半戦
#20 未来の芥川賞作家を探せ!書き出し王決定戦 前半戦
#21 未来の芥川賞作家を探せ!書き出し王決定戦 後半戦
#22 けやき坂46 学力テスト 前半戦
#23 けやき坂46 学力テスト 後半戦
#24 あなたのお悩み解決!「スナック眞緒」開店!【第1夜/第2夜/第3夜】
#25 けやき坂46何でもランキング その1
#26 けやき坂46何でもランキング その2
#27 けやき坂46何でもランキング その3
#28 あなたのお悩み解決!「スナック眞緒」【第4夜/第5夜/第6夜】
#29 チーム対抗!!3分リレークッキング 前半戦
#30 チーム対抗!!3分リレークッキング 後半戦
#31 けやき坂46 絵心ミュージアム
#32 あなたのお悩み解決!「スナック眞緒」【第7夜/第8夜/第9夜】
#33 オードリーとの距離をもっと縮めよう 前半戦
#34 オードリーとの距離をもっと縮めよう 後半戦
#35 あなたのお悩み解決!「スナック眞緒」【第10夜/第11夜/第12夜】
#36 けやき坂46 ぶりっ子選手権! 前半戦
#37 けやき坂46 ぶりっ子選手権! 後半戦
#38 新春! けやき坂46! 2019年 一番運が良いのは誰だランキング
#39 成人vs未成年 大人力対決!! 前半戦
#40 成人vs未成年 大人力対決!! 後半戦
#41 ひらがなメンバー初めての企画プレゼンを皆で何とか成功させよう!
#42 唯一の三期生 上村ひなのをみんなでもっと知ろう!
#43 「へのつっぱりはいらんですよ!」キン肉マンを習得しよう!
#44 あなたのお悩み解決!「スナック眞緒」【第13夜/第14夜/第15夜】
#45 松田好花プレゼンツ! ひらがな がっきょくうんどうかい1
#46 松田好花プレゼンツ! ひらがな がっきょくうんどうかい2
#47 あなたのお悩み解決!「スナック眞緒」【第16夜/第17夜/最終夜】
#47 日向坂46 デビューシングルヒット祈願 内容発表!!
#48 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その1
#49 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その2
#50 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その3
```

本稿執筆時に引っ掛かったので書いておきますが、`「\1」`を`「&」`としてしまうと、マッチした文字列全体が入ります。

つまり、（）で括った部分だけでなく特殊文字参照が残ってしまいます。

#### 決め打ちの修正

この部分の表記揺れ修正が地味に面倒です。空白があるやらないやら、`!`があるやらないやら…

```
#01 春日プレゼンツ!丸暗記 メンバープロフィール紹介!その1
#02 春日プレゼンツ!丸暗記 メンバープロフィール紹介!その2
#03 春日プレゼンツ!丸暗記メンバープロフィール紹介 その3
#04 春日プレゼンツ! 丸暗記メンバープロフィール紹介その4
```

sedにより、空白を消す処理と!を追加する処理を入れます。

`sed -r "/丸暗記/{s;([介記\!])[ ]([そ丸メ]);\1\2;g; s;(その[3-4]);\!\1;g}"`

対象行をここに絞るため、「丸暗記」が含まれている行に対して置換操作を適用します。2つの置換文を`{}`で挟みましたが、今回初めて使いました。。

`s;([介記\!])[ ]([そ丸メ]);\1\2;g`により、「丸暗記 メンバー」と「紹介 その3」と「プレゼンツ! 丸暗記」の空白を削除しています。

`s;(その[3-4]);\!\1;g`により、「紹介その3」「紹介その4」に入っていない`!`を追加します。


## 回答例

`cat 1st`、`cat 2nd`としていた部分を`curl`で取得する部分に置き換えれば完了です。

`cat <(curl -s https://www.hinatazaka46.com/s/official/news/detail/R00068?ima=0000 | grep -B7 特典映像①  | sed -r "s;<[^>]*>;;g") <(curl -s https://www.hinatazaka46.com/s/official/news/detail/R00117?ima=0000 | sed "s;<br />;\n;g" | grep -B7 特典映像)  | grep -E "#|＃|♯" | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g" | sort | sed "y/　①②③１２３４５６７８９０！/ 1231234567890\!/" | sed -r "s/&rdquo;(.*)&rdquo;/「\1」/g" | sed -r "/丸暗記/{s;([介記\!])[ ]([そ丸メ]);\1\2;g; s;(その[3-4]);\!\1;g}"`

表記揺れ修正で出来ることはやりました。ここまで来れば良いでしょう…w

```
$ cat <(curl -s https://www.hinatazaka46.com/s/official/news/detail/R00068?ima=0000 | grep -B7 特典映像①  | sed -r "s;<[^>]*>;;g") <(curl -s https://www.hinatazaka46.com/s/official/news/detail/R00117?ima=0000 | sed "s;<br />;\n;g" | grep -B7 特典映像)  | grep -E "#|＃|♯" | sed -r "s;(#|＃|♯);#0;g" | sed -r "s;#.([0-9][0-9]);#\1;g" | sort | sed "y/　①②③１２３４５６７８９０！/ 1231234567890\!/" | sed -r "s/&rdquo;(.*)&rdquo;/「\1」/g" | sed -r "/丸暗記/{s;([介記\!])[ ]([そ丸メ]);\1\2;g; s;(その[3-4]);\!\1;g}"
#01 春日プレゼンツ!丸暗記メンバープロフィール紹介!その1
#02 春日プレゼンツ!丸暗記メンバープロフィール紹介!その2
#03 春日プレゼンツ!丸暗記メンバープロフィール紹介!その3
#04 春日プレゼンツ!丸暗記メンバープロフィール紹介!その4
#05 けやき坂46 結成2周年記念 抜き打ちカバンの中身チェック! 前半戦
#06 けやき坂46 結成2周年記念 抜き打ちカバンの中身チェック! 後半戦
#07 春日に挑戦!特技バトル!!前半戦
#08 春日に挑戦!特技バトル!!後半戦
#09 妄想みらいヒストリー（富田・丹生・影山・井口）
#10 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願!!前半戦
#11 けやき坂46 デビューアルバム「走り出す瞬間」ヒット祈願!!後半戦
#12 けやき坂46ヤングVSアダルト バラエティゲームバトル
#13 けやき坂46の世界一やりたい授業
#14 さらなる魅力を引き出せ!家族アンケート 前半戦
#15 さらなる魅力を引き出せ!家族アンケート 後半戦
#16 ドキッ!けやき坂46だらけの爆笑大喜利大会 前編
#17 ドキッ!けやき坂46だらけの爆笑大喜利大会 後編
#18 一期生VS二期生 運動能力バトル! 前半戦
#19 一期生VS二期生 運動能力バトル! 後半戦
#20 未来の芥川賞作家を探せ!書き出し王決定戦 前半戦
#21 未来の芥川賞作家を探せ!書き出し王決定戦 後半戦
#22 けやき坂46 学力テスト 前半戦
#23 けやき坂46 学力テスト 後半戦
#24 あなたのお悩み解決!「スナック眞緒」開店!【第1夜/第2夜/第3夜】
#25 けやき坂46何でもランキング その1
#26 けやき坂46何でもランキング その2
#27 けやき坂46何でもランキング その3
#28 あなたのお悩み解決!「スナック眞緒」【第4夜/第5夜/第6夜】
#29 チーム対抗!!3分リレークッキング 前半戦
#30 チーム対抗!!3分リレークッキング 後半戦
#31 けやき坂46 絵心ミュージアム
#32 あなたのお悩み解決!「スナック眞緒」【第7夜/第8夜/第9夜】
#33 オードリーとの距離をもっと縮めよう 前半戦
#34 オードリーとの距離をもっと縮めよう 後半戦
#35 あなたのお悩み解決!「スナック眞緒」【第10夜/第11夜/第12夜】
#36 けやき坂46 ぶりっ子選手権! 前半戦
#37 けやき坂46 ぶりっ子選手権! 後半戦
#38 新春! けやき坂46! 2019年 一番運が良いのは誰だランキング
#39 成人vs未成年 大人力対決!! 前半戦
#40 成人vs未成年 大人力対決!! 後半戦
#41 ひらがなメンバー初めての企画プレゼンを皆で何とか成功させよう!
#42 唯一の三期生 上村ひなのをみんなでもっと知ろう!
#43 「へのつっぱりはいらんですよ!」キン肉マンを習得しよう!
#44 あなたのお悩み解決!「スナック眞緒」【第13夜/第14夜/第15夜】
#45 松田好花プレゼンツ! ひらがな がっきょくうんどうかい1
#46 松田好花プレゼンツ! ひらがな がっきょくうんどうかい2
#47 あなたのお悩み解決!「スナック眞緒」【第16夜/第17夜/最終夜】
#47 日向坂46 デビューシングルヒット祈願 内容発表!!
#48 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その1
#49 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その2
#50 日向坂46 デビューシングルヒット祈願120km駅伝の全記録をみんなで見よう! その3
```

おひさま向けの話ですが、`「好きな人いるの？ニブだよ編」`に以下のタイトルがあるじゃないですか。

「#09 妄想みらいヒストリー（富田・丹生・影山・井口）」

妄想みらいヒストリーという企画は過去2回やっているのですが、ひらがな推しでは1回しかやっていないんですよね。

括弧書きで誰の発表回か区別する必要が無いのにわざわざ書いてある…ということは。

これは**ひなましょうBD確定演出**なのでは…？

## ○○する芸能ちゃんブロック

日向坂46のお題を持ってきたということは、今回紹介するのは当然このチャンネルの代表作です。私がまる芸ちゃんを知ったきっかけは紛れもなくこの回です。

「日向坂で会いましょう」を知っている方がより楽しめますが、中身はノンジャンルクイズなので見てなくとも楽しめます。

#### 【前半】
<div class="youtube">
<iframe width="560" height="315" src="https://www.youtube.com/embed/rALqZ-NeGnM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

#### 【後半】

<div class="youtube">
<iframe width="560" height="315" src="https://www.youtube.com/embed/37HLAAIFhM0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

番組を見ている人にはとにかく突き刺さる編集の細かさ、企画の角度、そして天の声以外におひさまが居ないという演者のバランスが素晴らしい内容です。

この動画が公開されたのは日向坂46が高校生クイズのサポーターになる遥か前の2021年2月。

本家のクイズ企画は、リモート収録で行われたアメリカ横断ウルトラクイズ風の企画（第2回学力テスト）が2020年6月。良い感じに期間が空いていました。

テレビ好きには既に名の通っているクイズ王日髙大介をプレゼンする内容、直後にクイズ番組で今にも活躍しそうな影山優佳の復活があり、そしてケイマックスの守備範囲の広さを考えるとワンチャンあるぞ…！？と思ったものです。**というか、今も思っています。**

<style>
.youtube {
  position: relative;
  width: 100%;
  padding-top: 56.25%;
}
.youtube iframe {
  position: absolute;
  top: 0;
  right: 0;
  width: 100% !important;
  height: 100% !important;
}
</style>